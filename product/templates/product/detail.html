{% extends 'base.html' %}


{% block title %}
    {{product.name}}
{% endblock title %}
    
{% block content %}
<div class="product-details">
    <div class="image-showcase">
        <div class="image-nav" data-direction="Prev">&lt;</div>
            <div class="images">
                <img src="/{{product.thumbnail.url}}"/>
                <img src="/{{product.image_1.url}}"/>    
            </div>
            <div class="magnifier"></div>
        <div class="image-nav" data-direction="Next">&gt;</div>
    </div>
    <div class="details">
        <div class="bar">
            <div class="title">
                <div class="name">{{product.name}}</div>
                <div class="price">{{product.price}}</div>    
            </div>
        </div>
        <div class="buttons">
            <a class="buy">Buy now</a>
            <a class="cart">Add to cart</a>
        </div>
        <div class="description">
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Adipisci illum maxime placeat aliquam? Minima asperiores quae blanditiis at eaque excepturi vel distinctio vero delectus eligendi, dignissimos mollitia soluta, odit repudiandae harum quam doloribus praesentium voluptate quos facilis error quod. Quisquam aliquid voluptatibus atque sunt consectetur eligendi deleniti aut debitis. Sunt, neque iste id expedita nam maxime eos consequuntur labore minima corrupti ducimus autem ea possimus debitis adipisci dolores dignissimos delectus perspiciatis deserunt iusto ex saepe sint qui? Esse minus quod adipisci neque perspiciatis dicta libero, enim nulla eius cum, delectus corporis repellat, ullam voluptatum rerum a fugiat ratione assumenda et?</p>
            <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Tempora laborum natus repudiandae repellendus. Quia similique provident facilis? Vitae natus molestias aut doloremque quos tempore ipsa temporibus accusantium et impedit eveniet vel dolores laboriosam autem ea, sit quia iste laudantium laborum mollitia nesciunt sequi. Veritatis ea odio reiciendis impedit iure nostrum.</p>
        </div>
    </div>
</div>
<script>
    const showcase = document.querySelector('.images')
    var zoom = 1.3


    document.querySelectorAll('.image-nav').forEach(button => {
        button.addEventListener('click', (e) => {
            var imgWidth = showcase.childNodes[1].width
            var pxToScroll = imgWidth / 2 + 100
            if (e.target.dataset.direction == 'Next'){
                console.log(imgWidth)
                showcase.scrollTo(imgWidth + pxToScroll, 0)
            }
            else{
                showcase.scrollTo(-pxToScroll, 0)
            }
        })
    })

    showcase.childNodes.forEach(image => {
        
        image.addEventListener('mousemove', e => {
            const glass = document.querySelector('.magnifier')
            img = e.target
            posX = e.layerX % img.width
            posY = e.layerY + 1 % img.height
        
            
            if (img.tagName == 'IMG' && e.layerX % img.width > 70){
                img.style.filter = 'opacity(0.5)'
                glass.style.display = 'block';

                // Pure Hack
                glass.style.backgroundImage = 'url(\'' + img.attributes['src'].value + '\')'
                glass.style.backgroundSize = (img.width * zoom) + 'px ' + (img.height * zoom)  + 'px' 
                glass.style.backgroundPosition = '-' + (posX - 70) + 'px -' + posY + 'px'
                glass.style.left = posX + 'px'
                glass.style.top = posY + 'px'
                glass.style.scale = '100%'
            }
            
            hideMagnifier = (image) => {
            }
            
            image.addEventListener('mouseleave', () => {
                image.style.filter = 'opacity(1)'
                glass.style.scale = '0%'
                glass.addEventListener('animationend', ()=>{
                    setTimeout(100)
                })
                glass.style.display = 'none'
            })
        })
    })
</script>
{% endblock content %}
        